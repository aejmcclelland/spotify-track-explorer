{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/andrewmcclelland/Documents/spotify-track-explorer/ste-client/src/lib/api.ts"],"sourcesContent":["const API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8080\";\n\nfunction getToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(\"access_token\") ?? localStorage.getItem(\"token\");\n}\n\nexport async function postJson<T>(path: string, body: unknown): Promise<T> {\n  const token = getToken();\n  const headers: Record<string, string> = { \"Content-Type\": \"application/json\" };\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  console.debug(\"API fetch\", path, { hasAuth: !!headers[\"Authorization\"] });\n  const res = await fetch(`${API_BASE}${path}`, {\n    method: \"POST\",\n    headers,\n    body: JSON.stringify(body),\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `HTTP ${res.status}`);\n  }\n  return res.json();\n}\n\nexport async function getJson<T>(path: string): Promise<T> {\n  const token = getToken();\n  const headers: Record<string, string> = {};\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  console.debug(\"API fetch\", path, { hasAuth: !!headers[\"Authorization\"] });\n  const res = await fetch(`${API_BASE}${path}`, {\n    headers,\n    cache: \"no-store\",\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `HTTP ${res.status}`);\n  }\n  return res.json();\n}\n"],"names":[],"mappings":";;;;;;AAAA,MAAM,WAAW,QAAQ,GAAG,CAAC,oBAAoB,IAAI;AAErD,SAAS;IACP,wCAAmC,OAAO;;;AAE5C;AAEO,eAAe,SAAY,IAAY,EAAE,IAAa;IAC3D,MAAM,QAAQ;IACd,MAAM,UAAkC;QAAE,gBAAgB;IAAmB;IAC7E,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;IAC9C;IACA,QAAQ,KAAK,CAAC,aAAa,MAAM;QAAE,SAAS,CAAC,CAAC,OAAO,CAAC,gBAAgB;IAAC;IACvE,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QAC5C,QAAQ;QACR;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;IAC9C;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,QAAW,IAAY;IAC3C,MAAM,QAAQ;IACd,MAAM,UAAkC,CAAC;IACzC,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;IAC9C;IACA,QAAQ,KAAK,CAAC,aAAa,MAAM;QAAE,SAAS,CAAC,CAAC,OAAO,CAAC,gBAAgB;IAAC;IACvE,MAAM,MAAM,MAAM,MAAM,GAAG,WAAW,MAAM,EAAE;QAC5C;QACA,OAAO;IACT;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;IAC9C;IACA,OAAO,IAAI,IAAI;AACjB","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/andrewmcclelland/Documents/spotify-track-explorer/ste-client/src/app/me/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { getJson } from \"@/lib/api\";\nimport Link from \"next/link\";\n\ntype Me = { username: string; roles: string[] };\n\nexport default function MePage() {\n  const router = useRouter();\n  const [me, setMe] = useState<Me | null>(null);\n  const [err, setErr] = useState<string | null>(null);\n  const [linking, setLinking] = useState(false);\n\n  useEffect(() => {\n    const token =\n      typeof window !== \"undefined\"\n        ? localStorage.getItem(\"access_token\")\n        : null;\n    if (!token) {\n      router.replace(\"/login\");\n      return;\n    }\n\n    let mounted = true;\n    getJson<Me>(\"/api/me\")\n      .then((data) => {\n        if (mounted) setMe(data);\n      })\n      .catch((e: Error) => {\n        if (!mounted) return;\n        const msg = e.message || \"Failed to load\";\n        if (msg.startsWith(\"401\")) {\n          localStorage.removeItem(\"access_token\");\n          setErr(\"Not signed in\");\n          router.replace(\"/login\");\n        } else {\n          setErr(msg);\n        }\n      });\n    return () => {\n      mounted = false;\n    };\n  }, [router]);\n\n  if (err) return <div className=\"alert\">{err}</div>;\n  if (!me) return <div className=\"loading loading-spinner loading-md\" />;\n\n  async function connectSpotify() {\n    try {\n      setLinking(true);\n      const { authorize_url } = await getJson<{ authorize_url: string }>(\n        \"/api/spotify/authorize\"\n      );\n      window.location.href = authorize_url;\n    } catch (e: any) {\n      setLinking(false);\n      alert(e?.message ?? \"Failed to start Spotify link\");\n    }\n  }\n\n  return (\n    <div className=\"prose\">\n      <h1>Account</h1>\n      <p>\n        <b>User:</b> {me.username}\n      </p>\n      <p>\n        <b>Roles:</b> {me.roles && me.roles.length ? me.roles.join(\", \") : \"—\"}\n      </p>\n      <button\n        className=\"btn btn-outline\"\n        onClick={connectSpotify}\n        disabled={linking}\n      >\n        {linking ? \"Connecting…\" : \"Connect Spotify\"}\n      </button>\n      <div className=\"mt-3\">\n        <Link className=\"btn\" href=\"/spotify\">\n          View Spotify Playlists\n        </Link>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;AAJA;;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,IAAA,8QAAS;IACxB,MAAM,CAAC,IAAI,MAAM,GAAG,IAAA,gVAAQ,EAAY;IACxC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,gVAAQ,EAAgB;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gVAAQ,EAAC;IAEvC,IAAA,iVAAS,EAAC;QACR,MAAM,QACJ,sCACI,0BACA;QACN,wCAAY;YACV,OAAO,OAAO,CAAC;YACf;QACF;;;QAEA,IAAI;IAmBN,GAAG;QAAC;KAAO;IAEX,IAAI,KAAK,qBAAO,6WAAC;QAAI,WAAU;kBAAS;;;;;;IACxC,IAAI,CAAC,IAAI,qBAAO,6WAAC;QAAI,WAAU;;;;;;IAE/B,eAAe;QACb,IAAI;YACF,WAAW;YACX,MAAM,EAAE,aAAa,EAAE,GAAG,MAAM,IAAA,4HAAO,EACrC;YAEF,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB,EAAE,OAAO,GAAQ;YACf,WAAW;YACX,MAAM,GAAG,WAAW;QACtB;IACF;IAEA,qBACE,6WAAC;QAAI,WAAU;;0BACb,6WAAC;0BAAG;;;;;;0BACJ,6WAAC;;kCACC,6WAAC;kCAAE;;;;;;oBAAS;oBAAE,GAAG,QAAQ;;;;;;;0BAE3B,6WAAC;;kCACC,6WAAC;kCAAE;;;;;;oBAAU;oBAAE,GAAG,KAAK,IAAI,GAAG,KAAK,CAAC,MAAM,GAAG,GAAG,KAAK,CAAC,IAAI,CAAC,QAAQ;;;;;;;0BAErE,6WAAC;gBACC,WAAU;gBACV,SAAS;gBACT,UAAU;0BAET,UAAU,gBAAgB;;;;;;0BAE7B,6WAAC;gBAAI,WAAU;0BACb,cAAA,6WAAC,sSAAI;oBAAC,WAAU;oBAAM,MAAK;8BAAW;;;;;;;;;;;;;;;;;AAM9C","debugId":null}}]
}