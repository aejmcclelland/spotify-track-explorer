{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/andrewmcclelland/Documents/spotify-track-explorer/ste-client/src/lib/api.ts"],"sourcesContent":["const API_BASE = process.env.NEXT_PUBLIC_API_BASE ?? \"http://localhost:8080\";\n\nfunction getToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(\"access_token\") ?? localStorage.getItem(\"token\");\n}\n\nexport async function postJson<T>(path: string, body: unknown): Promise<T> {\n  const token = getToken();\n  const headers: Record<string, string> = {\n    \"Content-Type\": \"application/json\",\n  };\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  console.debug(\"API fetch\", path, { hasAuth: !!headers[\"Authorization\"] });\n  const res = await fetch(`${API_BASE}${path}`, {\n    method: \"POST\",\n    headers,\n    body: JSON.stringify(body),\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `HTTP ${res.status}`);\n  }\n  return res.json();\n}\n\nexport async function getJson<T>(path: string): Promise<T> {\n  const token = getToken();\n  const headers: Record<string, string> = {};\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n  console.debug(\"API fetch\", path, { hasAuth: !!headers[\"Authorization\"] });\n  const res = await fetch(`${API_BASE}${path}`, {\n    headers,\n    cache: \"no-store\",\n  });\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `HTTP ${res.status}`);\n  }\n  return res.json();\n}\n\n// DELETE /api/spotify/profile\nexport async function delJson(path: string): Promise<void> {\n  const token = getToken();\n  const headers: Record<string, string> = {};\n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n\n  console.debug(\"API delete\", path, { hasAuth: !!headers[\"Authorization\"] });\n\n  const res = await fetch(`${API_BASE}${path}`, {\n    method: \"DELETE\",\n    headers,\n  });\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(text || `HTTP ${res.status}`);\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAiB;IAAA;AAAjB,MAAM,WAAW,CAAA,oCAAA,0SAAO,CAAC,GAAG,CAAC,oBAAoB,cAAhC,+CAAA,oCAAoC;AAErD,SAAS;IACP;;QACO;IAAP,OAAO,CAAA,wBAAA,aAAa,OAAO,CAAC,6BAArB,mCAAA,wBAAwC,aAAa,OAAO,CAAC;AACtE;AAEO,eAAe,SAAY,IAAY,EAAE,IAAa;IAC3D,MAAM,QAAQ;IACd,MAAM,UAAkC;QACtC,gBAAgB;IAClB;IACA,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,AAAC,UAAe,OAAN;IACvC;IACA,QAAQ,KAAK,CAAC,aAAa,MAAM;QAAE,SAAS,CAAC,CAAC,OAAO,CAAC,gBAAgB;IAAC;IACvE,MAAM,MAAM,MAAM,MAAM,AAAC,GAAa,OAAX,UAAgB,OAAL,OAAQ;QAC5C,QAAQ;QACR;QACA,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,AAAC,QAAkB,OAAX,IAAI,MAAM;IAC5C;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,QAAW,IAAY;IAC3C,MAAM,QAAQ;IACd,MAAM,UAAkC,CAAC;IACzC,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,AAAC,UAAe,OAAN;IACvC;IACA,QAAQ,KAAK,CAAC,aAAa,MAAM;QAAE,SAAS,CAAC,CAAC,OAAO,CAAC,gBAAgB;IAAC;IACvE,MAAM,MAAM,MAAM,MAAM,AAAC,GAAa,OAAX,UAAgB,OAAL,OAAQ;QAC5C;QACA,OAAO;IACT;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,AAAC,QAAkB,OAAX,IAAI,MAAM;IAC5C;IACA,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe,QAAQ,IAAY;IACxC,MAAM,QAAQ;IACd,MAAM,UAAkC,CAAC;IACzC,IAAI,OAAO;QACT,OAAO,CAAC,gBAAgB,GAAG,AAAC,UAAe,OAAN;IACvC;IAEA,QAAQ,KAAK,CAAC,cAAc,MAAM;QAAE,SAAS,CAAC,CAAC,OAAO,CAAC,gBAAgB;IAAC;IAExE,MAAM,MAAM,MAAM,MAAM,AAAC,GAAa,OAAX,UAAgB,OAAL,OAAQ;QAC5C,QAAQ;QACR;IACF;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ,AAAC,QAAkB,OAAX,IAAI,MAAM;IAC5C;AACF","debugId":null}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///Users/andrewmcclelland/Documents/spotify-track-explorer/ste-client/src/app/me/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { getJson, delJson } from \"@/lib/api\"; // you already have getJson; add a small delJson if needed\n\ntype Me = { username: string; roles: string[] };\ntype SpotifyProfile = { display_name?: string };\n\nexport default function MePage() {\n  const [me, setMe] = useState<Me | null>(null);\n  const [err, setErr] = useState<string | null>(null);\n  const [linking, setLinking] = useState(false);\n  const [spProfile, setSpProfile] = useState<SpotifyProfile | null>(null);\n  const [disconnecting, setDisconnecting] = useState(false);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const user = await getJson<Me>(\"/api/me\");\n        setMe(user);\n      } catch (e: any) {\n        setErr(\"Not signed in\");\n      }\n    })();\n  }, []);\n\n  // check spotify link status after we know user is signed in\n  useEffect(() => {\n    if (!me) return;\n    (async () => {\n      try {\n        const prof = await getJson<SpotifyProfile>(\"/api/spotify/profile\");\n        setSpProfile(prof);\n      } catch {\n        setSpProfile(null); // not linked or 401 from Spotify\n      }\n    })();\n  }, [me]);\n\n  const connectSpotify = async () => {\n    setLinking(true);\n    try {\n      const data = await getJson<{ authorize_url: string; state: string }>(\n        \"/api/spotify/authorize\"\n      );\n      window.location.href = data.authorize_url;\n    } catch (e: any) {\n      setErr(e?.message ?? \"Failed to start Spotify auth\");\n    } finally {\n      setLinking(false);\n    }\n  };\n\n  const disconnectSpotify = async () => {\n    setDisconnecting(true);\n    try {\n      await delJson(\"/api/spotify/link\");\n      setSpProfile(null);\n    } catch (e: any) {\n      setErr(e?.message ?? \"Failed to disconnect\");\n    } finally {\n      setDisconnecting(false);\n    }\n  };\n\n  if (err) return <div className=\"alert alert-error\">{err}</div>;\n  if (!me) return <div className=\"loading loading-spinner\" />;\n\n  return (\n    <div className=\"p-4 space-y-4\">\n      <h1 className=\"text-2xl font-bold\">Account</h1>\n      <div>\n        Username: <b>{me.username}</b>\n      </div>\n      <div>\n        Roles: <b>{me.roles.join(\", \")}</b>\n      </div>\n\n      <div className=\"divider\" />\n\n      <div className=\"flex items-center gap-3\">\n        {spProfile ? (\n          <>\n            <span className=\"badge badge-success\">\n              Linked as {spProfile.display_name ?? \"Spotify user\"}\n            </span>\n            <button\n              className=\"btn btn-outline btn-sm\"\n              onClick={disconnectSpotify}\n              disabled={disconnecting}\n            >\n              {disconnecting ? \"Disconnecting…\" : \"Disconnect Spotify\"}\n            </button>\n            <Link className=\"btn btn-sm\" href=\"/spotify\">\n              View Spotify playlists\n            </Link>\n          </>\n        ) : (\n          <button\n            className=\"btn btn-outline\"\n            onClick={connectSpotify}\n            disabled={linking}\n          >\n            {linking ? \"Connecting…\" : \"Connect Spotify\"}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA,0MAA8C,0DAA0D;;;AAJxG;;;;AASe,SAAS;;IACtB,MAAM,CAAC,IAAI,MAAM,GAAG,IAAA,wSAAQ,EAAY;IACxC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,wSAAQ,EAAgB;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,wSAAQ,EAAC;IACvC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,wSAAQ,EAAwB;IAClE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wSAAQ,EAAC;IAEnD,IAAA,ySAAS;4BAAC;YACR;oCAAC;oBACC,IAAI;wBACF,MAAM,OAAO,MAAM,AAFvB,IAEuB,+HAAO,AAK7B,EALkC;wBAC/B,MAAM;oBACR,EAAE,OAAO,GAAQ;wBACf,OAAO;oBACT;gBACF;;QACF;2BAAG,EAAE;IAEL,4DAA4D;IAC5D,IAAA,ySAAS;4BAAC;YACR,IAAI,CAAC,IAAI;YACT;oCAAC;oBACC,IAAI;wBACF,MAAM,OAAO,MAAM,AAFvB,IAEuB,+HAAO,AAK7B,EAL8C;wBAC3C,aAAa;oBACf,EAAE,UAAM;wBACN,aAAa,OAAO,iCAAiC;oBACvD;gBACF;;QACF;2BAAG;QAAC;KAAG;IAEP,MAAM,iBAAiB;QACrB,WAAW;QACX,IAAI;YACF,MAAM,OAAO,MAAM,IAAA,+HAAO,EACxB;YAEF,OAAO,QAAQ,CAAC,IAAI,GAAG,KAAK,aAAa;QAC3C,EAAE,OAAO,GAAQ;gBACR;YAAP,OAAO,CAAA,aAAA,cAAA,wBAAA,EAAG,OAAO,cAAV,wBAAA,aAAc;QACvB,SAAU;YACR,WAAW;QACb;IACF;IAEA,MAAM,oBAAoB;QACxB,iBAAiB;QACjB,IAAI;YACF,MAAM,IAAA,+HAAO,EAAC;YACd,aAAa;QACf,EAAE,OAAO,GAAQ;gBACR;YAAP,OAAO,CAAA,aAAA,cAAA,wBAAA,EAAG,OAAO,cAAV,wBAAA,aAAc;QACvB,SAAU;YACR,iBAAiB;QACnB;IACF;IAEA,IAAI,KAAK,qBAAO,4TAAC;QAAI,WAAU;kBAAqB;;;;;;IACpD,IAAI,CAAC,IAAI,qBAAO,4TAAC;QAAI,WAAU;;;;;;QAkBR;IAhBvB,qBACE,4TAAC;QAAI,WAAU;;0BACb,4TAAC;gBAAG,WAAU;0BAAqB;;;;;;0BACnC,4TAAC;;oBAAI;kCACO,4TAAC;kCAAG,GAAG,QAAQ;;;;;;;;;;;;0BAE3B,4TAAC;;oBAAI;kCACI,4TAAC;kCAAG,GAAG,KAAK,CAAC,IAAI,CAAC;;;;;;;;;;;;0BAG3B,4TAAC;gBAAI,WAAU;;;;;;0BAEf,4TAAC;gBAAI,WAAU;0BACZ,0BACC;;sCACE,4TAAC;4BAAK,WAAU;;gCAAsB;gCACzB,CAAA,0BAAA,UAAU,YAAY,cAAtB,qCAAA,0BAA0B;;;;;;;sCAEvC,4TAAC;4BACC,WAAU;4BACV,SAAS;4BACT,UAAU;sCAET,gBAAgB,mBAAmB;;;;;;sCAEtC,4TAAC,ySAAI;4BAAC,WAAU;4BAAa,MAAK;sCAAW;;;;;;;iDAK/C,4TAAC;oBACC,WAAU;oBACV,SAAS;oBACT,UAAU;8BAET,UAAU,gBAAgB;;;;;;;;;;;;;;;;;AAMvC;GArGwB;KAAA","debugId":null}}]
}